# AI智能合同分析管理系统设计与实现——敏捷开发需求文档（7天版本V2.0）

# 1. 项目概述

## 1.1 项目名称

AI智能合同分析管理系统设计与实现

## 1.2 项目周期

7天（敏捷迭代，每日站会同步进度，晚间完成当日功能部署）

## 1.3 核心目标

在7天内构建一个功能完整、体验流畅、可直接商用的Web系统，实现"合同上传-智能解析-结构化展示-风险预警-日历同步-合同管理"全流程闭环，核心解决企业及个人合同管理中"效率低、风险隐、管理乱"的痛点，提升合同处理效率与风险防控能力。

## 1.4 产品定位

面向中小微企业法务、行政人员及个人用户的轻量化智能合同工具，无需专业IT部署，注册即可使用，聚焦合同处理核心需求，兼顾专业性与易用性。

## 1.5 敏捷策略

- MVP聚焦核心价值：以"能用、好用、解决实际问题"为原则，优先实现闭环功能

- 优先级分级机制：P0（必须实现）、P1（强烈建议）、P2（迭代补充），每日优先完成P0任务

- 增量开发模式：每日功能可独立运行，叠加形成完整系统，支持随时演示

- 用户视角驱动：开发过程中模拟真实使用场景，确保功能贴合实际需求

# 2. 技术栈（已确定，不争议）

## 2.1 前端技术栈

- 核心框架：Vue 3 + <script setup>（Composition API优化开发效率）

- 构建工具：Vite（提升编译速度，支持热更新）

- UI组件库：Element Plus（提供丰富表单、卡片、弹窗等组件）

- 路由管理：Vue Router（实现页面间无刷新跳转）

- 状态管理：Pinia（轻量高效，管理全局状态如用户信息、加载状态）

- 网络请求：Axios（封装请求拦截器，统一处理JWT认证与错误）

- 辅助工具：ics.js（生成日历文件）、vue-pdf（PDF预览）、vue-word-preview（Word预览）

## 2.2 后端技术栈

- 服务框架：Express.js（轻量灵活，快速构建API服务）

- 身份认证：JWT + bcrypt（实现无状态登录与密码安全存储）

- ORM工具：Prisma（类型安全，简化数据库操作，对接Supabase）

- 文件处理：multer（文件上传）+ pdf-parse/mammoth（文本提取）

- AI能力：OpenAI GPT-4 API（优先选用，解析精度更高）

- 部署平台：后端Railway、前端Vercel（支持自动部署，稳定性好）

## 2.3 数据层

- 主数据库：Supabase PostgreSQL（云数据库，无需本地部署，支持自动备份）

- 文件存储：MVP阶段本地服务器暂存 + Supabase Storage（备用，防止服务器故障丢失文件）

- 缓存策略：Redis（可选P1功能，缓存高频访问的合同解析结果，提升响应速度）

# 3. 核心功能清单（按优先级分级）

**说明**：P0-核心必实现，P1-提升体验必实现，P2-迭代补充功能

## 3.1 Day 1-2：基础支撑与合同管理（P0+P1）

### 1. 用户管理模块

- **P0 注册功能**：邮箱格式验证 + 密码强度检测（至少8位含字母数字）+ 重复密码确认 + 邮箱唯一性校验

- **P0 登录功能**：邮箱密码登录 + 记住登录状态（7天有效期）+ 登录错误提示（区分账号不存在/密码错误）

- **P1 安全控制**：登录失败3次后锁定5分钟 + 未登录状态拦截（跳转登录页并记录原访问地址）

- **P1 个人中心**：展示用户邮箱 + 密码修改功能（需输入原密码验证）

### 2. 合同管理模块

- **P0 文件上传**：支持PDF/docx格式拖放上传 + 点击选择文件 + 格式错误提示 + 20MB大小限制提示 + 上传进度条展示

- **P0 合同列表**：仪表盘默认展示合同列表，包含标题、原始文件名、上传时间、分析状态（待分析/分析完成/分析失败）、操作按钮（查看/编辑/删除）

- **P0 基础操作**：标题编辑（弹窗修改，支持50字以内）+ 删除功能（二次确认弹窗，明确提示"删除后不可恢复"）

- **P1 合同分类**：支持手动标记合同类型（下拉选择：劳动合同/租赁合同/采购合同/其他）+ 按类型筛选功能

- **P1 搜索功能**：支持按合同标题关键词模糊搜索，实时显示匹配结果

## 3.2 Day 3-4：AI解析核心能力（P0+P1）

### 3. 文本提取模块

- **P0 格式适配**：支持PDF（扫描件暂不支持，提示"仅支持可编辑PDF"）、docx格式文本提取，提取成功率≥95%

- **P1 提取优化**：保留文本段落结构 + 去除无意义空格与特殊字符 + 提取失败时返回明确错误原因（如文件损坏）

### 4. AI智能分析模块

- **P0 分析触发**：文件上传完成后自动触发AI分析，无需手动操作

- **P0 数据提取**：
        关键条款：甲乙双方名称、合同金额（含币种）、支付方式、合同编号、履行地点

- 风险点：自动续费条款、违约金约定、单方解除权、争议解决方式（诉讼/仲裁）、模糊表述

- 关键日期：签订日期、生效日期、履行开始日期、履行截止日期、付款日期、质保期截止日期

**P0 结果存储**：分析结果以JSONB格式存入数据库，与合同强关联，支持数据回溯

**P1 风险分级**：风险点按严重程度标记（高风险🔴/中风险🟡/低风险🟢），高风险优先展示

**P1 分析监控**：前端实时展示分析状态（分析中/已完成/失败），分析失败支持手动重试

**P1 提示词优化**：内置专业合同分析提示词模板，确保提取精度，关键日期提取准确率≥98%

## 3.3 Day 5：结果展示与交互体验（P0+P1）

### 5. 合同详情模块

- **P0 布局设计**：左右分栏自适应布局，左侧占比60%（合同预览），右侧占比40%（分析结果），平板端自动切换为上下布局

- **P0 合同预览**：支持滚动查看完整文本 + 关键信息高亮（点击右侧分析结果，左侧对应文本自动标黄）

- **P0 结果展示**：
        关键信息卡：表格形式展示，清晰列出提取项与对应内容，支持复制单个字段值

- 风险提示卡：按风险等级排序，每条风险点标注等级+具体条款内容+风险说明（如"自动续费条款可能导致无意识续约"）

- 关键日期卡：卡片式展示，到期日使用红色边框突出，标注剩余天数（如"距离合同到期还有15天"）

**P1 交互优化**：支持详情页返回列表 + 合同状态实时更新 + 无分析结果时显示"分析中"动画

## 3.4 Day 6：增值功能与系统优化（P0+P1）

### 6. 日历导出模块

- **P0 导出功能**：关键日期卡配置"添加到日历"按钮，点击生成ICS文件，包含所有关键日期（标注日期类型如"合同到期日"）

- **P1 导出优化**：ICS文件命名规范（合同标题+日期类型）+ 导出成功提示 + 支持批量导出选中合同的关键日期

- **P1 兼容性说明**：提供导出后导入指南（适配Google日历/Outlook/苹果日历的操作步骤简述）

### 7. 系统优化模块

- **P0 加载提示**：上传、分析、搜索等操作时显示加载动画 + 进度提示（如"分析进度30%"）

- **P0 错误处理**：网络异常、服务器错误等场景显示友好提示 + 一键重试功能

- **P1 响应式适配**：桌面端（≥1200px）、平板端（768px-1199px）、小屏平板（≤767px）布局自适应，功能正常可用

- **P1 性能优化**：合同列表分页加载（每页10条）+ 图片懒加载 + 接口请求防抖节流

## 3.5 Day 7：测试部署与迭代功能（P0+P2）

### 8. 测试与部署模块

- **P0 功能测试**：完成核心功能验收测试，确保流程闭环无断点

- **P0 部署上线**：完成前端Vercel、后端Railway部署，数据库配置，确保系统可公开访问

- **P0 数据备份**：配置Supabase自动备份策略（每日凌晨备份），防止数据丢失

### 9. 迭代补充功能（P2，Day7视时间实现）

- 合同版本管理：支持上传合同新版本，保留历史版本记录，可切换查看不同版本

- 风险预警提醒：到期日前3天自动发送邮件提醒（需用户开启提醒权限）

- 分析结果导出：支持将关键条款、风险点等分析结果导出为Excel文件

# 4. 数据库表结构（增强版）

## 4.1 users（用户表）

|字段名|类型|约束|说明|
|---|---|---|---|
|id|UUID|主键，默认uuid_generate_v4()|用户唯一标识|
|email|String|唯一，非空|用户登录邮箱|
|password_hash|String|非空|bcrypt加密后的密码|
|created_at|Timestamp|默认now()|用户注册时间|
|updated_at|Timestamp|默认now()|用户信息更新时间|
|login_attempts|Integer|默认0|登录失败次数|
|lock_until|Timestamp|可空|账号锁定截止时间|
## 4.2 contracts（合同表）

|字段名|类型|约束|说明|
|---|---|---|---|
|id|UUID|主键|合同唯一标识|
|user_id|UUID|外键关联users.id|所属用户ID，实现数据隔离|
|file_name|String|非空|原始文件名（含后缀）|
|file_url|String|非空|服务器存储路径|
|supabase_url|String|可空|Supabase备份路径|
|title|String|非空，默认file_name|合同标题（可编辑）|
|type|String|默认"其他"|合同类型（劳动合同/租赁合同等）|
|uploaded_at|Timestamp|默认now()|上传时间|
|analysis_status|String|默认"pending"|分析状态（pending/complete/failed）|
## 4.3 contract_analyses（合同分析表）

|字段名|类型|约束|说明|
|---|---|---|---|
|id|UUID|主键|分析结果唯一标识|
|contract_id|UUID|外键关联contracts.id|关联合同ID|
|extracted_text|Text|非空|提取的合同完整文本|
|key_terms|JSONB|非空|关键条款，格式：{"甲方":"xxx","乙方":"xxx","金额":"xxx"...}|
|risk_points|JSONB|非空|风险点，格式：[{"level":"high","content":"xxx","desc":"xxx"},...]|
|key_dates|JSONB|非空|关键日期，格式：[{"type":"签订日期","date":"2025-12-01"},...]|
|analyzed_at|Timestamp|默认now()|分析完成时间|
|ai_model|String|非空|使用的AI模型（如"gpt-4"）|
## 4.4 contract_versions（合同版本表，P2）

|字段名|类型|约束|说明|
|---|---|---|---|
|id|UUID|主键|版本记录唯一标识|
|contract_id|UUID|外键关联contracts.id|关联主合同ID|
|file_url|String|非空|历史版本文件路径|
|version_num|Integer|非空|版本号（V1/V2...）|
|created_at|Timestamp|默认now()|版本创建时间|
# 5. 验收标准（细化可执行）

|模块|功能点|验收标准（可量化/可复现）|测试方法|
|---|---|---|---|
|用户系统|注册|1. 无效邮箱格式提示错误；2. 密码＜8位提示强度不足；3. 重复邮箱提示已注册；4. 注册后自动跳转登录页|输入无效邮箱、弱密码、重复邮箱测试|
||登录|1. 账号密码正确登录后跳转仪表盘；2. 错误密码提示明确；3. 登录失败3次锁定5分钟；4. 未登录访问详情页跳转登录页|正确/错误密码登录、连续错误3次、未登录访问受保护页面|
||密码修改|1. 原密码错误无法修改；2. 新密码符合强度要求；3. 修改后需重新登录|输入错误原密码、符合/不符合要求的新密码测试|
||安全控制|1. JWT令牌有效期7天；2. 密码存储为加密格式，非明文|查看localStorage中令牌有效期、数据库密码存储形式|
|合同管理|文件上传|1. 支持PDF/docx格式，其他格式提示错误；2. ＞20MB文件提示超限；3. 上传进度条正常显示；4. 上传后列表实时更新|上传不同格式、不同大小文件测试|
||合同操作|1. 标题编辑后实时保存；2. 删除时二次确认；3. 分类筛选与关键词搜索结果准确|编辑标题、删除合同、筛选搜索测试|
||状态展示|分析状态（待分析/完成/失败）准确展示，无错乱|上传文件后观察状态变化，模拟分析失败场景|
|AI解析|文本提取|1. 提取文本与原合同内容一致，无缺失；2. 提取成功率≥95%；3. 提取失败提示明确原因|上传10份不同合同文件，对比提取结果与原文|
||智能分析|1. 关键条款提取完整度≥90%；2. 关键日期提取准确率≥98%；3. 风险点识别准确率≥85%；4. 30秒内完成分析|使用标准合同测试，人工校验提取结果|
|结果展示与导出|详情展示|1. 左右/上下布局适配正常；2. 分析结果分类清晰；3. 点击结果左侧文本标黄定位准确|在不同尺寸设备上查看合同详情|
||日历导出|1. 点击导出生成ICS文件；2. 文件可成功导入Google/Outlook/苹果日历；3. 日期信息准确无误|导出ICS文件并导入不同日历工具验证|
|系统性能|响应速度|1. 页面加载时间＜2秒；2. 接口响应时间＜500ms；3. 分析操作≤30秒|使用浏览器开发者工具查看加载与响应时间|
||兼容性|Chrome/Firefox/Edge最新版本中功能正常，无样式错乱|在三种浏览器中逐一测试核心功能|
# 6. 交付物清单（完整可追溯）

## 6.1 可运行系统交付物

- 前端系统：Vercel部署公开访问链接，支持直接注册使用

- 后端服务：Railway部署API服务链接，提供接口访问测试页面

- 数据库：Supabase实例访问权限（含管理后台账号密码），已配置自动备份

- 测试账号：提供1个测试用账号（邮箱+密码），包含5份测试合同数据

## 6.2 代码资产交付物

- 代码仓库：前端（GitHub/GitLab）、后端（GitHub/GitLab）仓库链接，开放读取权限

- 代码分支：main分支（稳定可运行版本）、dev分支（开发分支），提交记录完整

- 配置文件：提供.env环境变量配置模板（标注必填项与说明）

- 数据库脚本：Prisma迁移脚本（schema.prisma文件），支持一键生成数据库表结构

## 6.3 文档交付物

- 系统使用手册：1页图文PDF，包含注册登录、合同上传、结果查看、日历导出操作步骤

- API接口文档：Postman集合文件 + 在线Swagger文档链接，包含所有接口参数、返回值说明

- 部署指南：前端Vercel、后端Railway部署步骤文档，含环境配置、域名绑定说明

- 技术白皮书：简要说明技术栈选型理由、系统架构图、核心流程说明

## 6.4 测试交付物

- 功能测试报告：核心功能测试用例（含输入、预期输出、实际结果）、通过率统计

- 兼容性测试报告：不同浏览器、设备测试结果记录

- 性能测试报告：页面加载时间、接口响应时间、AI分析耗时测试数据

- 问题修复记录：开发过程中发现的问题及修复方案，未修复问题说明（含迭代计划）

# 7. 风险与应对（细化责任与措施）

|风险类型|具体描述|影响等级|应对措施|责任角色|
|---|---|---|---|---|
|AI能力风险|GPT-4 API调用超时/解析准确率低，尤其是复杂合同的关键信息提取错误|高|1. 提前准备优化后的提示词模板，包含合同分析专业术语；2. 设置API调用超时时间（15秒），超时自动重试1次；3. 预留Google Gemini API作为备用，配置切换开关；4. 关键日期提取增加格式校验逻辑|后端开发|
|文件处理风险|大文件（接近20MB）上传超时、特殊格式PDF/Word文本提取失败|中|1. 前端实现分片上传功能；2. 后端增加文件格式预处理步骤；3. 提供明确的文件格式/大小要求提示；4. 提取失败时返回具体错误，支持重新上传|前后端协作|
|部署环境风险|Railway/Vercel免费版资源限制导致服务不稳定，Supabase访问延迟|中|1. 选择Railway Hobby计划（低成本）避免资源限制；2. 前端配置接口请求重试机制；3. 提前1天完成部署验证，预留环境配置时间；4. 备份数据库至本地（Day7晚间执行）|全栈开发|
|时间管理风险|某环节开发耗时超预期，导致后续功能无法按时完成|高|1. 每日站会（15分钟）同步进度，识别延误风险；2. 制定功能降级方案（如P1功能优先保证核心流程，细节优化延后）；3. 核心功能（P0）安排优先级最高，预留Day6下午- Day7上午作为缓冲时间|项目负责人|
|数据安全风险|用户密码明文存储、合同数据未按用户隔离，导致信息泄露|高|1. 严格使用bcrypt加密密码；2. 所有接口增加user_id过滤条件，确保用户只能访问自己的合同；3. JWT密钥使用环境变量存储，不硬编码；4. 部署后测试越权访问场景|后端开发|
|兼容性风险|前端页面在不同浏览器/设备上样式错乱、功能失效|中|1. 使用Element Plus自适应组件；2. 开发过程中定期在Chrome/Firefox/Edge中测试；3. 针对平板端单独调试布局；4. 关键按钮/表单增加兼容性样式处理|前端开发|
# 8. 项目执行计划（按天细化）

|日期|核心任务|具体工作内容|交付成果|
|---|---|---|---|
|Day1|基础架构搭建 + 用户模块开发|1. 前端项目初始化（Vue3+Vite+Element Plus）；2. 后端项目初始化（Express+Prisma）；3. 数据库表设计与迁移；4. 用户注册/登录接口开发；5. 登录页与注册页开发|1. 前后端项目框架；2. 数据库表结构；3. 可运行的注册登录功能|
|Day2|合同管理模块开发|1. 合同上传接口开发（支持文件存储）；2. 仪表盘与合同列表页开发；3. 合同标题编辑/删除功能开发；4. 个人中心与密码修改功能开发；5. 未登录拦截功能实现|1. 可运行的合同上传功能；2. 合同列表管理功能；3. 完整的用户权限控制|
|Day3|文本提取模块 + AI接口对接|1. PDF/docx文本提取功能开发；2. 合同分析状态管理功能；3. OpenAI GPT-4 API对接；4. 文本提取接口与前端联调；5. AI分析触发逻辑开发|1. 可运行的文本提取功能；2. AI接口调用能力；3. 分析状态实时更新|
|Day4|AI分析结果处理 + 数据存储|1. AI返回结果解析与结构化处理；2. 分析结果存储接口开发；3. 风险分级逻辑实现；4. 分析失败重试功能开发；5. 后端接口联调与测试|1. 结构化的AI分析结果；2. 完整的后端数据处理流程；3. 分析失败重试机制|
|Day5|合同详情页开发 + 交互优化|1. 合同详情页布局开发；2. 合同文本预览功能；3. 分析结果卡片展示开发；4. 关键信息高亮定位功能；5. 响应式布局适配开发|1. 可运行的合同详情页；2. 清晰的分析结果展示；3. 适配不同设备的布局|
|Day6|日历导出功能 + 系统优化|1. ICS文件生成功能开发；2. 批量导出功能开发；3. 加载提示与错误处理优化；4. 性能优化（分页、懒加载）；5. 全流程功能联调|1. 可运行的日历导出功能；2. 优化后的系统性能；3. 完整的功能闭环|
|Day7|测试 + 部署 + 文档整理|1. 核心功能全面测试与Bug修复；2. 前端Vercel部署；3. 后端Railway部署；4. 数据库备份配置；5. 交付文档整理与完善|1. 可公开访问的系统；2. 完整的交付文档；3. 测试报告与问题记录|
# 9. 后续迭代规划（V2.0版本）

基于7天MVP版本，后续迭代可重点补充以下功能，提升产品竞争力：

- **功能增强**：OCR识别扫描件合同、多语言合同解析、合同对比功能、批量上传与批量分析、团队协作与权限管理

- **体验优化**：自定义风险规则、合同模板库、智能批注功能、移动端适配、多端同步（Web+小程序）

- **安全升级**：短信验证登录、数据加密存储、操作日志审计、第三方登录集成（企业微信/钉钉）

- **生态扩展**：对接企业ERP系统、电子签章集成、合同履行进度跟踪、智能报表生成

本文档为7天敏捷开发核心指南，开发过程中需严格遵循"优先级驱动"原则，确保P0功能实现完整闭环，P1功能优先提升核心体验，P2功能视时间灵活调整。每日结束前完成当日功能部署与演示，及时发现并解决问题。
> （注：文档部分内容可能由 AI 生成）