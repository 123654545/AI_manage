// E:\HTML_learning\AI_manage3\backend\prisma\schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id             String    @id @default(uuid())
  email          String    @unique
  passwordHash   String
  loginAttempts  Int       @default(0)
  lockUntil      DateTime?
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  
  contracts      Contract[]

  @@map("users")
}

model Contract {
  id              String     @id @default(uuid())
  userId          String
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  fileName        String
  fileUrl         String
  supabaseUrl     String?
  title           String
  type            String     @default("其他")
  uploadedAt      DateTime   @default(now())
  analysisStatus  String     @default("pending")
  
  analysis        ContractAnalysis?
  
  @@index([userId])
  @@index([uploadedAt])
}

model ContractAnalysis {
  id             String    @id @default(uuid())
  contractId     String    @unique
  contract       Contract  @relation(fields: [contractId], references: [id], onDelete: Cascade)
  extractedText  String
  keyTerms       String    // JSON string
  riskPoints     String    // JSON string
  keyDates       String    // JSON string
  analyzedAt     DateTime  @default(now())
  aiModel        String
  
  @@index([contractId])
}